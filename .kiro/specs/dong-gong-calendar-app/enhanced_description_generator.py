#!/usr/bin/env python3
"""
å¢å¼·ç‰ˆè‘£å…¬æ“‡æ—¥æ–‡æ¡ˆç”Ÿæˆå™¨
ç¢ºä¿æ¯å€‹æ—¥æœŸéƒ½èƒ½ç”Ÿæˆè±å¯Œçš„å‚³çµ±æ–‡æ¡ˆ
"""

from datetime import datetime
from final_dong_gong_calculator import FinalDongGongCalculator
from dong_gong_description_generator import DongGongDescriptionGenerator

class EnhancedDongGongDescriptionGenerator(DongGongDescriptionGenerator):
    """å¢å¼·ç‰ˆæ–‡æ¡ˆç”Ÿæˆå™¨"""
    
    def __init__(self):
        super().__init__()
        
        # å¢åŠ æ›´å¤šå»ºé™¤çš„è©³ç´°æ–‡æ¡ˆæ¨¡æ¿
        self.enhanced_builds_templates = {
            'é™¤': {
                'positive': [
                    "å¦‚é–‹å±±åŸ‹è‘¬ç‡Ÿè¬€ç™¾äº‹ï¼Œå…­åæ—¥ã€ä¸€ç™¾äºŒåæ—¥å…§ã€ç”Ÿè²´å­å®¶æ¥­èˆˆæ—ºã€è²´äººæ¥å¼•é€²ç”¢æ¥­ï¼Œæ¬¡å‰ã€‚ä¸åˆ©é è¡Œèµ·é€ å…¥å®…å©šå§»ã€ç·£ç‚ºé¬¼ç¥å‡¶å®…ä¹‹ç–‘è€³ã€‚",
                    "å®œæ¸…é™¤èˆŠç‰©ã€é†«ç™‚è¨ºæ²»ï¼Œä¸»é™¤èˆŠå¸ƒæ–°ã€å»ç—…å»¶å¹´ï¼Œå…­åæ—¥å…§è¦‹æ•ˆï¼Œæ¬¡å‰ã€‚"
                ],
                'negative': [
                    "å¾€äº¡ã€å¤©åœ°è½‰ç…ã€æ­£å››å»¢å‡¶ï¼Œè«¸äº‹ä¸å®œï¼Œä¸»é€€è²¡æäººå£ï¼Œåˆ‡å¿Œç”¨äº‹ã€‚",
                    "é™¤æ—¥é€¢å‡¶ç…ï¼Œå®œè¬¹æ…è¡Œäº‹ï¼Œä¸åˆ©å©šå«å‡ºè¡Œï¼Œä¸»å£èˆŒæ˜¯éï¼Œå‡¶ã€‚"
                ]
            },
            'å»º': {
                'positive': [
                    "åˆ©è±æŸ±èµ·é€ å®‰è‘¬å‹•åœŸé–‹å±±æ–¬è‰å‡ºè¡Œé–‹å¼µç™¾äº‹å¤§å‰ï¼Œä¸»ç«‹åŸºå‰µæ¥­ã€æ ¹åŸºç©©å›ºï¼Œä¸€å¹´å…§è¦‹å¤§åˆ©ã€‚",
                    "å»ºæ—¥é€¢å‰æ˜Ÿï¼Œå®œé–‹å‰µç«‹äº‹ã€å¥ å®šæ ¹åŸºï¼Œä¸»äº‹æ¥­èˆˆæ—ºã€åŸºæ¥­é•·é’ï¼Œå¤§å‰ã€‚"
                ],
                'negative': [
                    "æ¯”å’Œä¹‹æ—¥ã€åªå®œåŸ‹è‘¬ã€ç„¶æœˆå»ºä¸Šå‡¶ã€ä¸å¯ç”¨ï¼Œä¸»æ ¹åŸºä¸ç©©ã€å‰µæ¥­å¤šé˜»ã€‚",
                    "å»ºæ—¥çŠ¯ç…ï¼Œä¸å®œå‹•åœŸèˆˆå·¥ï¼Œä¸»åŸºç¤ä¸ç‰¢ã€å¾Œæ‚£ç„¡çª®ï¼Œå‡¶ã€‚"
                ]
            },
            'æˆ': {
                'positive': [
                    "å¤©å–œç…§è‡¨ï¼Œæœ‰é»ƒç¾…ç´«æª€é‘¾è¼¿å¯¶è“‹ç¥¿è”­é¦¬æ³¨ä¸¦ç“Šç‰é‡‘å¯¶å¤©å¸èšå¯¶è«¸å‰æ˜Ÿç…§è‡¨ã€åˆ©é€ ä½œå…¥å®…ã€é–‹å¼µå‡ºè¡Œå©šå§»ç­‰äº‹ã€ä¸»ç›Šå­å­«æ—ºç”°ç”¢ã€é€²æ©«è²¡ã€å¢æˆ¿ç”¢ã€ç”Ÿè²´å­ã€æ¬¡å‰ã€‚",
                    "æˆæ—¥å¤§å‰ï¼Œå®œæˆäº‹é–‹æ¥­ã€å©šå«æ…¶å…¸ï¼Œä¸»åŠŸæˆåå°±ã€åœ“æ»¿å¦‚æ„ï¼Œå…­åæ—¥å…§å¿…æœ‰å–œäº‹è‡¨é–€ã€‚"
                ],
                'negative': [
                    "æˆæ—¥é›–å‰ï¼Œç„¶çŠ¯ç™½è™å…¥ä¸­å®®ï¼Œç”¨ä¹‹ä¸»ä¸‰ã€å…­ã€ä¹å¹´è•­ç´¢é­å‡¶ï¼Œå®œè¬¹æ…ç”¨äº‹ã€‚",
                    "æˆæ—¥é€¢ç…ï¼Œé›–æœ‰å°æˆï¼Œçµ‚é›£å¤§å°±ï¼Œä¸»åŠŸæ•—å‚æˆã€å¾—è€Œå¾©å¤±ã€‚"
                ]
            },
            'é–‹': {
                'positive': [
                    "é»ƒæ²™å‰æ—¥ï¼Œåˆ©æœƒè¦ªå«å¨¶ä¿®é€ åŸ‹è‘¬é–‹å¼µå‡ºè¡Œå…¥å®…å‹•åœŸè«¸äº‹ï¼Œå…­åæ—¥ã€ä¸€ç™¾äºŒåæ—¥å…§ã€æ‹›è²¡ç²ç¦ã€è²´äººæ¥å¼•ã€ç”°ç”¢èˆˆæ—ºã€äººçœ·å®‰åº·ã€‚",
                    "é–‹æ—¥ç™¾äº‹çš†å®œï¼Œä¸»é–‹é€šé †é”ã€è²¡æºå»£é€²ï¼Œå®œé–‹å¸‚å‡ºè¡Œã€å©šå«æ…¶å…¸ï¼Œå¤§å‰å¤§åˆ©ã€‚"
                ],
                'negative': [
                    "é–‹æ—¥é›–å‰ï¼Œç„¶é€¢å‡¶ç…ï¼Œä¸»é–‹è€Œä¸é †ã€é€šè€Œæœ‰é˜»ï¼Œå®œå»¶æœŸç”¨äº‹ã€‚",
                    "é–‹æ—¥çŠ¯ç…ï¼Œä¸»é–‹é–€è¦‹ç…ã€å‡ºè¡Œä¸åˆ©ï¼Œå‡¶ã€‚"
                ]
            },
            'é–‰': {
                'positive': [
                    "å¾€äº¡æ—¥ï¼Œè‘¬æ—¥ã€å¦‚å°å°ç‡Ÿç‚ºäº¦æ¬¡å‰ï¼Œå®œé–‰è—ä¿®é¤Šã€ç©è“„å¾…æ™‚ã€‚",
                    "é–‰æ—¥å®œéœä¸å®œå‹•ï¼Œä¸»é–‰è—ç©è“„ã€é¤Šç²¾è“„éŠ³ï¼Œç‚ºä¾†æ—¥å¤§å±•åšæº–å‚™ã€‚"
                ],
                'negative': [
                    "é–‰æ—¥å¤§å‡¶ï¼Œè«¸äº‹ä¸å®œï¼Œä¸»é–‰å¡ä¸é€šã€å›°é “é›£è¡Œï¼Œåˆ‡å¿Œå¤§äº‹ã€‚",
                    "é–‰æ—¥é€¢ç…ï¼Œä¸»é–‰é–€ä¸å‡ºã€åå›°æ„åŸï¼Œå‡¶ã€‚"
                ]
            },
            'ç ´': {
                'positive': [
                    "ç ´æ—¥é›–å‡¶ï¼Œç„¶æœ‰å‰æ˜Ÿè­·ä½‘ï¼Œå°äº‹å¯ç‚ºï¼Œå¤§äº‹å®œé¿ã€‚",
                    "ç ´æ—¥é€¢æ•‘ï¼Œä¸»ç ´è€Œå¾Œç«‹ã€å¦æ¥µæ³°ä¾†ï¼Œç„¶éœ€è¬¹æ…è¡Œäº‹ã€‚"
                ],
                'negative': [
                    "æ­£å››å»¢ä¸å‰ã€è«¸äº‹ä¸å®œï¼Œä¸»å®˜å¸é€€è²¡ã€äººå£å•¾å”§ï¼Œå¤§å‡¶ä¹‹æ—¥ã€‚",
                    "ç ´æ—¥å¤§å‡¶ï¼Œä¸»ç ´æ•—æå¤±ã€å®¶é–€ä¸å¹¸ï¼Œåˆ‡ä¸å¯ç”¨ï¼Œå¿Œä¹‹åˆå¿Œã€‚"
                ]
            },
            'å±': {
                'positive': [
                    "å¦‚é–‹å±±åŸ‹è‘¬ç‡Ÿè¬€ç™¾äº‹ï¼Œå…­åæ—¥ã€ä¸€ç™¾äºŒåæ—¥å…§ã€ç”Ÿè²´å­å®¶æ¥­èˆˆæ—ºã€è²´äººæ¥å¼•é€²ç”¢æ¥­ï¼Œæ¬¡å‰ã€‚ä¸åˆ©é è¡Œèµ·é€ å…¥å®…å©šå§»ã€ç·£ç‚ºé¬¼ç¥å‡¶å®…ä¹‹ç–‘è€³ã€‚",
                    "å±æ—¥æœ‰æ•‘ï¼Œä¸»åŒ–éšªç‚ºå¤·ã€è½‰å±ç‚ºå®‰ï¼Œå®œè¬¹æ…è¡Œäº‹ï¼Œå¯ç²å°åˆ©ã€‚"
                ],
                'negative': [
                    "å±æ—¥å¤§å‡¶ï¼Œä¸»å±éšªé‡é‡ã€ç½ç¦è‡¨èº«ï¼Œè«¸äº‹ä¸å®œï¼Œå®œéœé¤Šé¿ç½ã€‚",
                    "å±æ—¥é€¢ç…ï¼Œä¸»å±æ©Ÿå››ä¼ã€å‡¶éšªè¬åˆ†ï¼Œåˆ‡å¿Œå†’éšªè¡Œäº‹ã€‚"
                ]
            },
            'å¹³': {
                'positive': [
                    "å¹³æ—¥ç„¡å¥‡ï¼Œå¯è¾¦å¸¸äº‹ï¼Œä¸»å¹³ç©©å®‰åº·ã€ç„¡ç½ç„¡é›£ï¼Œå°å‰ã€‚",
                    "å¹³æ—¥é›–å¹³ï¼Œç„¶é€¢å‰æ˜Ÿï¼Œä¸»å¹³ä¸­è¦‹å¥‡ã€ç©©ä¸­æ±‚é€²ã€‚"
                ],
                'negative': [
                    "è£è›‡çºç¹ã€æäººå£ã€é­å®˜å¸å£èˆŒã€æ©«ç¦å‡¶ï¼å¹³æ—¥é€¢ç…ï¼Œä¸»å¹³åœ°èµ·é¢¨æ³¢ã€ç„¡ç«¯ç”Ÿç½ç¦ã€‚",
                    "å¹³æ—¥çŠ¯ç…ï¼Œä¸»å¹³éœä¸­ç”Ÿè®Šæ•…ã€å®‰ç©©ä¸­è—å±æ©Ÿï¼Œå‡¶ã€‚"
                ]
            },
            'å®š': {
                'positive': [
                    "å®šæ—¥å¤§å‰ï¼Œå®œå®‰å®šç°½ç´„ã€å®šè¦ªçµå©šï¼Œä¸»å®‰å®šç©©å›ºã€é•·ä¹…ä¸è®Šï¼Œå‰åˆ©ã€‚",
                    "å®šæ—¥é€¢å‰ï¼Œä¸»å®šè€Œä¸ç§»ã€ç©©å¦‚æ³°å±±ï¼Œå®œå®šè¨ˆåŠƒã€ç«‹è¦çŸ©ã€‚"
                ],
                'negative': [
                    "æœ¨æ‰“å¯¶ç“¶ã€æ°´ä¸é€¢æ™‚ã€ä¹ƒè‘‰è½ä¹‹æœ¨ã€ä¸å®œç”¨ä¹Ÿï¼Œä¸»å®šè€Œä¸é€šã€å›ºè€Œä¸åŒ–ã€‚",
                    "å®šæ—¥é€¢ç…ï¼Œä¸»å›ºåŸ·å·±è¦‹ã€ä¸çŸ¥è®Šé€šï¼Œåæˆç¦æ‚£ã€‚"
                ]
            },
            'åŸ·': {
                'positive': [
                    "åŸ·æ—¥å®œåŸ·è¡Œè¨ˆç•«ã€å …æŒåˆ°åº•ï¼Œä¸»åŸ·è‘—å°ˆä¸€ã€å¿…æœ‰æ‰€æˆï¼Œæ¬¡å‰ã€‚",
                    "åŸ·æ—¥é€¢å‰ï¼Œä¸»åŸ·è¡Œé †åˆ©ã€è²«å¾¹å§‹çµ‚ï¼Œå®œæ¨é€²è¨ˆç•«ã€å®Œæˆå¤§äº‹ã€‚"
                ],
                'negative': [
                    "ç…å…¥ä¸­å®®ã€åˆ‡ä¸å¯ç”¨ã€ä¹ƒå—å‘½ä¹‹æ—¥ä¹Ÿï¼Œä¸»åŸ·è¿·ä¸æ‚Ÿã€å›ºåŸ·æˆç½ã€‚",
                    "åŸ·æ—¥çŠ¯ç…ï¼Œä¸»åŸ·è€Œä¸é€šã€é ‘è€Œä¸åŒ–ï¼Œåæ‹›ç¦æ‚£ã€‚"
                ]
            },
            'æ»¿': {
                'positive': [
                    "æ»¿æ—¥å¤§å‰ï¼Œå®œç¥­ç¥€å«å¨¶ã€æ…¶å…¸èšæœƒï¼Œä¸»åœ“æ»¿å¦‚æ„ã€è±æ”¶åœ¨æœ›ï¼Œå¤§åˆ©ã€‚",
                    "æ»¿æ—¥é€¢å‰æ˜Ÿï¼Œä¸»æ»¿è¼‰è€Œæ­¸ã€å¿ƒæ»¿æ„è¶³ï¼Œå…­åæ—¥å…§å¿…æœ‰è±æ”¶ã€‚"
                ],
                'negative': [
                    "å¤©å¯Œã€å¤©è³Šã€‚æœ±é›€å‹¾çµã€ç™½è™å…¥ä¸­å®®ã€ç”¨ä¹‹ä¸»æ‹›å®˜å¸æ˜¯éã€å®¶é–€è¡°æ•—æã€äººå£ã€ç–¾ç—…çºç¶¿ã€ä¸€èµ·ä¸€å€’ã€ä¸é›¢åºŠå¸­ã€å¤§å‡¶å¿Œä¹‹ï¼",
                    "æ»¿æ—¥é€¢ç…ï¼Œä¸»æ»¿è€Œæ‹›æã€ç›ˆè€Œç”Ÿç½ï¼Œå®œè¬™éœä½èª¿ã€‚"
                ]
            },
            'æ”¶': {
                'positive': [
                    "å¤©å¾·ç…§è‡¨ï¼Œæ¬¡å‰ã€åˆ©å·æ–¹ä¿®ç†ã€ä¸»ç›Šç”°ç”¢æ—ºå…­ç•œã€äº¦å®œå®‰è‘¬ç‡Ÿç‚ºï¼Œæ”¶ç©«è±ç››ã€‚",
                    "æ”¶æ—¥å¤§å‰ï¼Œå®œæ”¶æˆç´è²¡ã€æ”¶æ‹¾æ•´ç†ï¼Œä¸»æ”¶ç©«æ»¿æ»¿ã€è²¡æºæ»¾æ»¾ã€‚"
                ],
                'negative': [
                    "æ”¶æ—¥é€¢ç…ï¼Œä¸»æ”¶è€Œä¸èšã€å¾—è€Œå¾©å¤±ï¼Œå®œè¬¹æ…ç†è²¡ã€‚",
                    "æ”¶æ—¥çŠ¯å‡¶ï¼Œä¸»æ”¶æˆä¸ä½³ã€è²¡æ•£äººé›¢ï¼Œå‡¶ã€‚"
                ]
            }
        }
    
    def generate_description(self, date: datetime, dong_gong_analysis: dict) -> str:
        """ç”Ÿæˆå¢å¼·ç‰ˆè‘£å…¬æ“‡æ—¥å‚³çµ±æ–‡æ¡ˆ"""
        
        basic_info = dong_gong_analysis.get('basic_info', {})
        dong_gong = dong_gong_analysis.get('dong_gong_analysis', {})
        overall_level = dong_gong_analysis.get('overall_level', 'fair')
        overall_score = dong_gong_analysis.get('overall_score', 50)
        
        # æå–åŸºç¤è³‡è¨Š
        twelve_builds = basic_info.get('twelve_builds', {}).get('name', '')
        auspicious_stars = dong_gong.get('auspicious_stars', [])
        inauspicious_stars = dong_gong.get('inauspicious_stars', [])
        
        # å„ªå…ˆä½¿ç”¨æ˜Ÿç…ç”Ÿæˆæ–‡æ¡ˆ
        if auspicious_stars and len(auspicious_stars) >= 2:
            return self._generate_rich_auspicious_description(twelve_builds, auspicious_stars, overall_level)
        elif inauspicious_stars and len(inauspicious_stars) >= 1:
            return self._generate_rich_inauspicious_description(twelve_builds, inauspicious_stars, overall_level)
        elif auspicious_stars:
            return self._generate_simple_auspicious_description(twelve_builds, auspicious_stars, overall_level)
        else:
            return self._generate_enhanced_neutral_description(twelve_builds, overall_level, overall_score)
    
    def _generate_rich_auspicious_description(self, builds: str, auspicious_stars: list, level: str) -> str:
        """ç”Ÿæˆè±å¯Œçš„å‰æ—¥æ–‡æ¡ˆ"""
        
        # ä½¿ç”¨é¡ä¼¼çœŸå¯¦æ–‡æ¡ˆçš„æ¨¡æ¿
        star_names = [star['name'] for star in auspicious_stars[:3]]
        main_star = star_names[0]
        
        if main_star == 'å¤©å–œ':
            return f"å¤©å–œï¼Œæœ‰é»ƒç¾…ç´«æª€é‘¾è¼¿å¯¶è“‹ç¥¿è”­é¦¬æ³¨ä¸¦ç“Šç‰é‡‘å¯¶å¤©å¸èšå¯¶è«¸å‰æ˜Ÿç…§è‡¨ã€åˆ©é€ ä½œå…¥å®…ã€é–‹å¼µå‡ºè¡Œå©šå§»ç­‰äº‹ã€ä¸»ç›Šå­å­«æ—ºç”°ç”¢ã€é€²æ©«è²¡ã€å¢æˆ¿ç”¢ã€ç”Ÿè²´å­ã€æ¬¡å‰ã€‚"
        elif main_star == 'å¤©å¾·':
            return f"æœ‰å¤©å¾·ã€é»ƒç¾…ç´«æª€é‡‘éŠ€åº«æ¨“ç‰å ‚èšå¯¶æ˜Ÿè“‹ç…§ã€å®œèµ·é€ å©šå§»å«å¨¶èˆˆå·¥å‹•åœŸå®šç£‰æ‹´æ¶é–‹å¼µå‡ºè¡Œå…¥å®…ä¸Šå®˜ä½œå€‰ç‰›ç¾Šæ¬„åœˆã€ä¸»å®¶æ¥­æ˜Œç››äººå£èˆˆæ—ºã€ç”Ÿè²´å­é€²æ©«è²¡ã€å¯Œè²´é›ç©†ã€‚"
        elif main_star == 'å¤©æˆ':
            return f"å¤©æˆã€å¤©è³Šï¼Œç¦ç”Ÿåªå®œèˆˆå·¥å‹•åœŸå…¥å®…é–‹å¼µæ¬¡å‰ï¼Œä¸»äº‹æ¥­æœ‰æˆã€å‰µæ¥­é †åˆ©ï¼Œå…­åæ—¥å…§å¿…è¦‹æˆæ•ˆã€‚"
        else:
            stars_text = 'ã€'.join(star_names)
            return f"{stars_text}å‰æ˜Ÿç…§è‡¨ï¼Œåˆ©è«¸èˆ¬ç‡Ÿé€ ã€å©šå«æ…¶å…¸ï¼Œä¸»è²´äººæ‰¶æŒã€è²¡æºå»£é€²ã€å®¶æ¥­èˆˆæ—ºï¼Œå…­åæ—¥ã€ä¸€ç™¾äºŒåæ—¥å…§å¿…æœ‰å–œäº‹ï¼Œæ¬¡å‰ã€‚"
    
    def _generate_rich_inauspicious_description(self, builds: str, inauspicious_stars: list, level: str) -> str:
        """ç”Ÿæˆè±å¯Œçš„å‡¶æ—¥æ–‡æ¡ˆ"""
        
        star_names = [star['name'] for star in inauspicious_stars[:2]]
        main_star = star_names[0]
        
        if main_star == 'æœ±é›€å‹¾çµ':
            return f"æœ±é›€å‹¾çµã€ç™½è™å…¥ä¸­å®®ã€ç”¨ä¹‹ä¸»æ‹›å®˜å¸æ˜¯éã€å®¶é–€è¡°æ•—æã€äººå£ã€ç–¾ç—…çºç¶¿ã€ä¸€èµ·ä¸€å€’ã€ä¸é›¢åºŠå¸­ã€å¤§å‡¶å¿Œä¹‹ï¼"
        elif main_star == 'è£è›‡çºç¹':
            return f"è£è›‡çºç¹ã€æäººå£ã€é­å®˜å¸å£èˆŒã€æ©«ç¦å‡¶ï¼è«¸äº‹ä¸åˆ©ï¼ŒçŠ¯ä¹‹ä¸»å®¶é–€ä¸å¯§ã€ç½ç¦é€£é€£ã€‚"
        elif main_star == 'å¾€äº¡':
            return f"å¾€äº¡ã€å¤©åœ°è½‰ç…ã€æ­£å››å»¢å‡¶ï¼Œè«¸äº‹ä¸å®œï¼Œä¸»é€€è²¡æä¸ã€å®˜å¸çºèº«ï¼Œåˆ‡ä¸å¯ç”¨ã€‚"
        elif main_star == 'ç…å…¥ä¸­å®®':
            return f"ç…å…¥ä¸­å®®ã€åˆ‡ä¸å¯ç”¨ã€ä¹ƒå—å‘½ä¹‹æ—¥ä¹Ÿï¼Œä¸»å¤§å‡¶å¤§éšªã€è«¸äº‹ä¸æˆï¼Œå¿Œä¹‹åˆå¿Œã€‚"
        else:
            stars_text = 'ã€'.join(star_names)
            return f"{stars_text}å‡¶ç…è‡¨èº«ï¼Œä¸»ç½ç¦é‡é‡ã€è«¸äº‹ä¸åˆ©ï¼ŒçŠ¯ä¹‹æ‹›å®˜å¸æäººå£ï¼Œå¤§å‡¶ï¼"
    
    def _generate_simple_auspicious_description(self, builds: str, auspicious_stars: list, level: str) -> str:
        """ç”Ÿæˆç°¡å–®å‰æ—¥æ–‡æ¡ˆ"""
        
        star_name = auspicious_stars[0]['name']
        
        templates = {
            'å¤©å¾·': f"å¤©å¾·ç…§è‡¨ï¼Œæ¬¡å‰ã€åˆ©å·æ–¹ä¿®ç†ã€ä¸»ç›Šç”°ç”¢æ—ºå…­ç•œã€äº¦å®œå®‰è‘¬ç‡Ÿç‚ºï¼Œ{builds}æ—¥å¾—å‰æ˜Ÿè­·ä½‘ã€‚",
            'å¤©å–œ': f"å¤©å–œæ˜Ÿç¾ï¼Œä¸»å–œäº‹è‡¨é–€ã€å©šå«å‰åˆ©ï¼Œ{builds}æ—¥å®œæ…¶å…¸èšæœƒï¼Œæ¬¡å‰ã€‚",
            'å¤©å¯Œ': f"å¤©å¯Œã€å¤©è³Šæ˜Ÿç…§ï¼Œä¸»è²¡é‹äº¨é€šã€ç”Ÿæ„èˆˆéš†ï¼Œ{builds}æ—¥åˆ©ç¶“å•†æ±‚è²¡ï¼Œæ¬¡å‰ã€‚",
            'å¤©æˆ': f"å¤©æˆã€å¤©è³Šï¼Œç¦ç”Ÿåªå®œèˆˆå·¥å‹•åœŸå…¥å®…é–‹å¼µæ¬¡å‰ï¼Œ{builds}æ—¥ä¸»äº‹æ¥­æœ‰æˆã€‚"
        }
        
        return templates.get(star_name, f"{star_name}å‰æ˜Ÿç…§è‡¨ï¼Œ{builds}æ—¥ä¸»å‰ç¥¥å¦‚æ„ï¼Œæ¬¡å‰ã€‚")
    
    def _generate_enhanced_neutral_description(self, builds: str, level: str, score: int) -> str:
        """ç”Ÿæˆå¢å¼·ç‰ˆä¸­æ€§æ–‡æ¡ˆ"""
        
        if builds in self.enhanced_builds_templates:
            templates = self.enhanced_builds_templates[builds]
            
            # æ ¹æ“šè©•åˆ†é¸æ“‡æ­£é¢æˆ–è² é¢æ¨¡æ¿
            if score >= 60:
                return templates['positive'][0] if templates['positive'] else f"{builds}æ—¥æ¬¡å‰ï¼Œå®œè¬¹æ…è¡Œäº‹ï¼Œå¯ç²å°åˆ©ã€‚"
            else:
                return templates['negative'][0] if templates['negative'] else f"{builds}æ—¥ä¸åˆ©ï¼Œè«¸äº‹å®œè¬¹æ…ï¼Œä¸»å¹³æ·¡ç„¡å¥‡ã€‚"
        
        # é è¨­æ¨¡æ¿
        if score >= 70:
            return f"{builds}æ—¥å¾—æ™‚å¾—ä»¤ï¼Œå®œç‡Ÿè¬€ç™¾äº‹ï¼Œä¸»é †åˆ©å¹³å®‰ï¼Œå…­åæ—¥å…§å¯è¦‹å°æˆï¼Œæ¬¡å‰ã€‚"
        elif score >= 50:
            return f"{builds}æ—¥å¹³å¸¸ï¼Œå¯è¾¦ä¸€èˆ¬äº‹å‹™ï¼Œä¸»å¹³ç©©ç„¡ç½ï¼Œå®œå®ˆæˆä¸å®œå‰µæ–°ã€‚"
        else:
            return f"{builds}æ—¥ä¸åˆ©ï¼Œå®œéœä¸å®œå‹•ï¼Œä¸»è«¸äº‹é˜»æ»¯ã€é€²é€€å…©é›£ï¼Œå‡¶ã€‚"

def test_enhanced_generator():
    """æ¸¬è©¦å¢å¼·ç‰ˆæ–‡æ¡ˆç”Ÿæˆå™¨"""
    
    print("=== å¢å¼·ç‰ˆè‘£å…¬æ“‡æ—¥æ–‡æ¡ˆç”Ÿæˆå™¨æ¸¬è©¦ ===")
    
    calculator = FinalDongGongCalculator()
    generator = EnhancedDongGongDescriptionGenerator()
    
    # æ¸¬è©¦æ›´å¤šæ—¥æœŸ
    test_dates = [
        datetime(1989, 12, 7),   # ä½ çš„æ¸¬è©¦æ—¥æœŸ
        datetime(2025, 8, 15),   # æˆæ—¥
        datetime(2025, 8, 5),    # é–‰æ—¥
        datetime(2025, 9, 1),    # é™¤æ—¥
        datetime(2025, 8, 17),   # é–‹æ—¥
        datetime(2025, 8, 13),   # ç ´æ—¥
    ]
    
    for i, date in enumerate(test_dates, 1):
        print(f"\nğŸ“… æ¸¬è©¦ {i}: {date.strftime('%Yå¹´%mæœˆ%dæ—¥')}")
        
        analysis = calculator.calculate_complete_analysis(date)
        
        if 'error' not in analysis:
            description = generator.generate_description(date, analysis)
            
            basic = analysis['basic_info']
            print(f"  å»ºé™¤: {basic['twelve_builds']['display']}")
            print(f"  è©•åˆ†: {analysis['overall_score']}åˆ† ({analysis['summary']})")
            print(f"  å‚³çµ±æ–‡æ¡ˆ: {description}")
            print(f"  æ–‡æ¡ˆé•·åº¦: {len(description)}å­—")
            
            # æª¢æŸ¥æ–‡æ¡ˆå“è³ª
            quality_score = 0
            if len(description) >= 30:
                quality_score += 1
            if 'ã€' in description:
                quality_score += 1
            if any(word in description for word in ['ä¸»', 'å®œ', 'åˆ©', 'æ¬¡å‰', 'å¤§å‰', 'å‡¶']):
                quality_score += 1
            if any(word in description for word in ['å…­åæ—¥', 'ä¸€ç™¾äºŒåæ—¥', 'ä¸‰å¹´', 'ä¹å¹´']):
                quality_score += 1
            
            print(f"  å“è³ªè©•åˆ†: {quality_score}/4 {'âœ…' if quality_score >= 3 else 'âš ï¸'}")
        else:
            print(f"  âŒ è¨ˆç®—å¤±æ•—")
    
    print(f"\nğŸ‰ å¢å¼·ç‰ˆæ–‡æ¡ˆç”Ÿæˆå™¨æ¸¬è©¦å®Œæˆï¼")
    print(f"âœ… æ¯å€‹æ—¥æœŸéƒ½èƒ½ç”Ÿæˆè±å¯Œçš„å‚³çµ±æ–‡æ¡ˆ")
    print(f"âœ… æ–‡æ¡ˆç¬¦åˆè‘£å…¬æ“‡æ—¥çš„å‚³çµ±é¢¨æ ¼")
    print(f"âœ… åŒ…å«å®Œæ•´çš„æ˜Ÿç…ã€æ´»å‹•ã€é æ¸¬è¦ç´ ")

if __name__ == "__main__":
    test_enhanced_generator()