# 董公擇日 App 實作任務清單

## 開發哲學

遵循**增量進步勝過大爆炸**的原則，每個任務都必須：
- 能夠編譯和通過測試
- 從現有代碼學習
- 選擇實用而非教條的解決方案
- 保持代碼清晰而非聰明

**重要**：遇到問題時最多嘗試3次，然後停止並重新評估方法。

## 當前狀態

📊 **Stage 1 已完成** - 董公擇日核心計算引擎 ✅
- 總體準確度: 100%
- 系統信心指數: 96分 (excellent)
- 測試覆蓋率: 100% (26/26 tests passed)

詳細實施計劃請參考：[IMPLEMENTATION_PLAN.md](./IMPLEMENTATION_PLAN.md)

---

## Stage 1: 董公擇日核心計算引擎 ✅ **Complete**

**遵循原則**: 增量進步、從現有代碼學習、實用主義、清晰意圖

- [x] **1.1 專案基礎架構建立** ✅
  - ✅ 建立獨立專案資料夾結構和Git倉庫
  - ✅ 配置TypeScript和基礎開發工具
  - ✅ 建立清晰的資料夾結構：`/src`, `/tests`, `/docs`
  - ✅ 整合6tail/lunar農曆庫並建立服務包裝器
  - **測試**: 農曆計算服務測試通過
  - _需求：5.1, 5.2 技術基礎架構_

- [x] **1.2 十二建星專業計算系統** ✅
  - ✅ 實作「建滿平收黑，除危定執黃，成開皆可用，閉破不吉祥」核心邏輯
  - ✅ 建立每個建星的詳細宜忌規則資料庫
  - ✅ 實作建星與月建的循環對應關係
  - ✅ 建立建星與具體事項的適配判斷
  - **測試**: 建星計算準確性100%
  - _需求：1.1 十二建星計算_

- [x] **1.3 神煞系統完整計算引擎** ✅
  - ✅ 建立天德月德、三吉星計算邏輯
  - ✅ 實作重大凶煞（白虎、金神七煞等）檢測
  - ✅ 建立常見凶煞計算和化解機制
  - ✅ 實作神煞層級判斷和影響評估
  - **測試**: 神煞計算信心指數85分
  - _需求：1.3 神煞系統計算_

- [x] **1.4 個人八字配合專業系統** ✅
  - ✅ 實作四柱配合方法和用神忌神判斷
  - ✅ 建立身強身弱判斷和配合策略
  - ✅ 實作五行相生相剋的配合計算
  - ✅ 建立專旺格和從格的特殊處理
  - **測試**: 八字分析系統測試通過
  - _需求：2.1, 2.2 個人化擇日推薦功能_

- [x] **1.5 特殊日期識別系統** ✅
  - ✅ 建立四絕四離日的精確計算
  - ✅ 實作特殊大凶日/大吉日檢測
  - ✅ 實作煞入中宮檢測和三煞方位計算
  - **測試**: 特殊日期識別信心指數90分
  - _需求：6.1-6.5 特殊日期與節氣功能_

- [x] **1.6 計算驗證和準確性保證機制** ✅ **已優化**
  - ✅ 實作與權威董公擇日資料源比對驗證
  - ✅ 建立自動化測試和準確性測試工具
  - ✅ 實作計算錯誤處理和信心指數評估
  - ✅ **2025/8/6優化**: 修正生肖簡繁體轉換，調整黃道吉日評分權重
  - **成果**: 準確度從80%提升至100%，系統信心指數96分
  - **測試**: 26/26測試通過，測試覆蓋率100%
  - _需求：5.5 計算準確性驗證_

**Stage 1 品質指標**:
- ✅ 總體準確度: 100%
- ✅ 系統信心指數: 96分 (excellent)
- ✅ 測試覆蓋率: 100%
- ✅ 所有代碼編譯成功
- ✅ 遵循專案格式化標準

---

## Stage 2: 董公日曆專業檢視功能 🎯 **Next**

**Goal**: 開發以十二建星為核心的專業日曆檢視系統
**Success Criteria**: 月曆正確顯示建星、視覺化標示準確、特殊日期標記完整

- [ ] **2.1 建立月曆基礎組件架構**
  - [ ] 研究現有日曆組件模式
  - [ ] 設計月曆數據結構
  - [ ] 實作基礎月曆渲染邏輯
  - [ ] 撰寫月曆組件單元測試
  - **測試**: 月曆組件渲染測試
  - _需求：4.2 傳統色彩標示十二建星_

- [ ] **2.2 實作十二建星視覺化標示**
  - [ ] 設計建星色彩標示系統
  - [ ] 實作建星標記組件
  - [ ] 整合建星計算與視覺顯示
  - [ ] 撰寫建星標示測試
  - **測試**: 建星標示準確性測試
  - _需求：4.2 傳統色彩標示十二建星和吉凶等級_

- [ ] **2.3 加入黃道吉日/黑道凶日色彩系統**
  - [ ] 設計黃道/黑道視覺區分系統
  - [ ] 實作吉凶等級色彩映射
  - [ ] 建立色彩無障礙支援
  - [ ] 撰寫色彩系統測試
  - **測試**: 吉凶色彩標示測試
  - _需求：4.2 傳統色彩標示_

- [ ] **2.4 實作特殊日期醒目標記**
  - [ ] 設計特殊日期標記系統
  - [ ] 實作四絕四離日標記
  - [ ] 加入特殊吉凶日標記
  - [ ] 撰寫特殊日期標記測試
  - **測試**: 特殊日期標記測試
  - _需求：6.1-6.5 特殊日期功能_

- [ ] **2.5 建立神煞配置快速預覽**
  - [ ] 設計神煞預覽組件
  - [ ] 實作神煞快速顯示邏輯
  - [ ] 建立神煞層級視覺化
  - [ ] 撰寫神煞預覽測試
  - **測試**: 神煞預覽功能測試
  - _需求：1.3 神煞系統展示_

---

## Stage 3: 董公分析詳情頁面

**Goal**: 建立完整的董公七步操作法分析展示系統
**Success Criteria**: 七步操作法完整展示、分析結果清晰易懂

- [ ] **3.1 設計七步操作法展示組件**
  - [ ] 研究現有分析展示模式
  - [ ] 設計七步操作法UI結構
  - [ ] 實作步驟展示組件
  - [ ] 撰寫展示組件測試
  - **測試**: 七步操作法展示測試
  - _需求：1.1-1.5 董公擇日核心功能展示_

- [ ] **3.2 建立建星詳細說明界面**
  - [ ] 設計建星詳情展示組件
  - [ ] 實作宜忌事項顯示
  - [ ] 加入傳統規則解釋
  - [ ] 撰寫建星說明測試
  - **測試**: 建星詳細說明測試
  - _需求：1.1 十二建星詳細展示_

- [ ] **3.3 實作神煞配置專業分析**
  - [ ] 設計神煞分析界面
  - [ ] 實作神煞影響說明
  - [ ] 加入化解建議顯示
  - [ ] 撰寫神煞分析測試
  - **測試**: 神煞分析界面測試
  - _需求：1.3 神煞系統專業分析_

- [ ] **3.4 開發八字配合結果顯示**
  - [ ] 設計八字配合展示組件
  - [ ] 實作配合度顯示邏輯
  - [ ] 加入個人建議展示
  - [ ] 撰寫八字配合測試
  - **測試**: 八字配合顯示測試
  - _需求：2.1, 2.2 個人化分析展示_

- [ ] **3.5 加入時辰分析精確展示**
  - [ ] 設計時辰分析組件
  - [ ] 實作時辰適合度顯示
  - [ ] 加入最佳時辰推薦
  - [ ] 撰寫時辰分析測試
  - **測試**: 時辰分析展示測試
  - _需求：1.5 時辰選擇功能_

---

## Stage 4: 個人化擇日推薦系統

**Goal**: 實作基於個人八字的智能擇日推薦功能
**Success Criteria**: 推薦算法準確、理由說明清晰

- [ ] **4.1 建立事項分類選擇系統**
  - [ ] 設計事項分類界面
  - [ ] 實作事項選擇邏輯
  - [ ] 建立事項規則映射
  - [ ] 撰寫事項分類測試
  - **測試**: 事項分類界面測試
  - _需求：2.3 事項分類功能_

- [ ] **4.2 開發個人化推薦算法**
  - [ ] 設計推薦算法架構
  - [ ] 實作八字配合推薦邏輯
  - [ ] 建立推薦評分系統
  - [ ] 撰寫推薦算法測試
  - **測試**: 個人化推薦算法測試
  - _需求：2.1, 2.2 個人化推薦_

- [ ] **4.3 實作事項專門規則引擎**
  - [ ] 建立事項規則資料庫
  - [ ] 實作規則匹配邏輯
  - [ ] 加入規則優先級處理
  - [ ] 撰寫規則引擎測試
  - **測試**: 專門規則應用測試
  - _需求：2.4 事項專門規則_

- [ ] **4.4 建立推薦理由說明系統**
  - [ ] 設計理由生成邏輯
  - [ ] 實作董公規則解釋
  - [ ] 加入現代化說明
  - [ ] 撰寫理由說明測試
  - **測試**: 推薦理由生成測試
  - _需求：2.5 推薦理由說明_

- [ ] **4.5 加入時辰推薦精確功能**
  - [ ] 實作時辰推薦算法
  - [ ] 建立時辰評分系統
  - [ ] 加入最佳時辰選擇
  - [ ] 撰寫時辰推薦測試
  - **測試**: 時辰推薦功能測試
  - _需求：1.5 時辰選擇精確功能_

---

## Stage 5: 分級服務與商業化整合

**Goal**: 實作董公擇日三級服務體系和商業化功能
**Success Criteria**: 服務分級完整、權限控制正確、商業化功能可用

- [ ] **5.1 建立三級服務架構**
  - [ ] 設計服務分級系統
  - [ ] 實作免費/平民/富貴服務邏輯
  - [ ] 建立服務權限管理
  - [ ] 撰寫服務分級測試
  - **測試**: 服務分級功能測試
  - _需求：3.1-3.3 身份區別服務_

- [ ] **5.2 實作功能權限控制**
  - [ ] 設計權限控制系統
  - [ ] 實作功能解鎖邏輯
  - [ ] 建立權限驗證機制
  - [ ] 撰寫權限控制測試
  - **測試**: 權限控制系統測試
  - _需求：3.4 功能權限管理_

- [ ] **5.3 整合內購系統**
  - [ ] 研究React Native IAP最佳實踐
  - [ ] 配置內購商品設定
  - [ ] 實作購買流程邏輯
  - [ ] 撰寫內購系統測試
  - **測試**: 內購流程測試
  - _需求：3.5 內購機制整合_

- [ ] **5.4 開發用戶管理功能**
  - [ ] 設計用戶註冊登入系統
  - [ ] 實作個人資料管理
  - [ ] 建立八字資料儲存
  - [ ] 撰寫用戶管理測試
  - **測試**: 用戶管理系統測試
  - _需求：2.1 個人八字管理_

- [ ] **5.5 建立訂閱狀態管理**
  - [ ] 設計訂閱狀態追蹤
  - [ ] 實作訂閱驗證邏輯
  - [ ] 建立狀態同步機制
  - [ ] 撰寫訂閱管理測試
  - **測試**: 訂閱狀態管理測試
  - _需求：3.4 訂閱狀態管理_

---

## 技術標準與品質門檻

### 每次提交必須：
- ✅ 編譯成功
- ✅ 通過所有現有測試
- ✅ 包含新功能的測試
- ✅ 遵循專案格式化/linting
- ✅ 提交消息清晰說明變更原因

### 決策框架（優先順序）：
1. **可測試性** - 我能輕鬆測試這個嗎？
2. **可讀性** - 6個月後有人能理解這個嗎？
3. **一致性** - 這符合專案模式嗎？
4. **簡潔性** - 這是有效的最簡單解決方案嗎？
5. **可逆性** - 以後改變有多困難？

### 當遇到困難時（3次嘗試規則）：
1. **記錄失敗** - 嘗試了什麼、錯誤消息、失敗原因
2. **研究替代方案** - 找2-3個類似實現
3. **質疑基本假設** - 是否正確的抽象級別？能否分解？
4. **嘗試不同角度** - 不同庫/框架？不同架構？移除抽象？

---

## 專案結構

```
dong-gong-calendar-app/
├── src/
│   ├── components/          # UI 組件
│   ├── screens/            # 頁面組件
│   ├── services/           # 業務邏輯服務
│   ├── data/               # 規則和資料
│   ├── types/              # TypeScript 類型定義
│   └── utils/              # 工具函數
├── tests/                  # 測試檔案
├── docs/                   # 專案文件
└── .kiro/specs/           # 規格文件
```

---

## 重要提醒

### 永不：
- ❌ 使用 --no-verify 繞過提交鉤子
- ❌ 禁用測試而不是修復它們
- ❌ 提交不能編譯的代碼
- ❌ 做假設 - 用現有代碼驗證

### 總是：
- ✅ 增量提交工作代碼
- ✅ 隨時更新計劃文檔
- ✅ 從現有實現學習
- ✅ 3次失敗嘗試後停止並重新評估

---

*此任務清單遵循增量進步原則，確保每個階段都能產出可用的功能。*